<div class="container mt-4">
  <h2>I miei Ordini</h2>

  <div *ngIf="infoMessage" class="alert alert-success">{{ infoMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <div *ngIf="orders.length === 0" class="alert alert-secondary">
    Non hai ancora effettuato ordini.
  </div>

  <div class="accordion" id="ordersAccordion">
    <div class="accordion-item" *ngFor="let order of orders; let i = index">
      <h2 class="accordion-header" [id]="'heading'+i">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse'+i" aria-expanded="false" [attr.aria-controls]="'collapse'+i">
          Ordine #{{ order.idOrdine }} - {{ order.data | date:'dd/MM/yyyy HH:mm' }} -
          <span class="badge ms-2"
                [ngClass]="{'bg-success': order.stato === 'PAGAMENTO_COMPLETATO',
                            'bg-danger': order.stato === 'ANNULLATO',
                            'bg-warning': order.stato === 'IN_ATTESA_DI_PAGAMENTO'}">
            {{ order.stato }}
          </span>
          <span class="ms-auto me-3">€ {{ order.totaleOrdine | number:'1.2-2' }}</span>
        </button>
      </h2>
      <div [id]="'collapse'+i" class="accordion-collapse collapse" [attr.aria-labelledby]="'heading'+i" data-bs-parent="#ordersAccordion">
        <div class="accordion-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item" *ngFor="let item of order.oggetti">
              {{ item.nome }} ({{ item.taglia }}/{{ item.colore }}) - Qt: {{ item.quantita }} - € {{ item.prezzo }}
            </li>
          </ul>

          <div class="mt-3 text-end" *ngIf="order.stato !== 'ANNULLATO' && order.stato !== 'SPEDITO' && order.stato !== 'CONSEGNATO'">
            <button class="btn btn-outline-danger btn-sm" (click)="cancelOrder(order.idOrdine)">
              Annulla Ordine
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
