<div class="container mt-4">
  <h2>I miei Ordini</h2>

  <div *ngIf="messaggio" class="alert alert-success alert-dismissible fade show">
    {{ messaggio }}
    <button type="button" class="btn-close" (click)="messaggio=''"></button>
  </div>
  <div *ngIf="errore" class="alert alert-danger alert-dismissible fade show">
    {{ errore }}
    <button type="button" class="btn-close" (click)="errore=''"></button>
  </div>

  <div *ngIf="orders.length === 0" class="alert alert-info">
    Non hai ancora effettuato ordini.
  </div>

  <div class="accordion" id="ordersAccordion" *ngIf="orders.length > 0">
    <div class="accordion-item" *ngFor="let order of orders">
      <h2 class="accordion-header" [id]="'heading'+order.idOrdine">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse'+order.idOrdine">
          Ordine #{{ order.idOrdine }} - {{ order.data | date:'dd/MM/yyyy HH:mm' }} -
          <span class="badge ms-2"
                [ngClass]="{
                    'bg-success': order.stato === 'CONSEGNATO',
                    'bg-warning': order.stato === 'IN_ATTESA' || order.stato === 'SPEDITO',
                    'bg-danger': order.stato === 'ANNULLATO'
                }">
            {{ order.stato }}
          </span>
          <span class="ms-auto me-3 fw-bold">€{{ order.totaleOrdine | number:'1.2-2' }}</span>
        </button>
      </h2>
      <div [id]="'collapse'+order.idOrdine" class="accordion-collapse collapse" data-bs-parent="#ordersAccordion">
        <div class="accordion-body">
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of order.oggetti">
              <div>
                <strong>{{ item.nome }}</strong> <br>
                <small>{{ item.taglia }} - {{ item.colore }}</small>
              </div>
              <span>{{ item.quantita }} x €{{ item.prezzo | number:'1.2-2' }}</span>
            </li>
          </ul>

          <button *ngIf="order.stato !== 'ANNULLATO' && order.stato !== 'CONSEGNATO'"
                  class="btn btn-danger btn-sm"
                  (click)="annullaOrdine(order.idOrdine)">
            Richiedi Annullamento
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
